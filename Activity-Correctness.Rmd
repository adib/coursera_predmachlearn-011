---
title: "Activity Correctess"
author: "Sasmito Adibowo"
date: "20 February 2015"
output: html_document
mainfont: Palatino
sansfont: Lucida Grande
monofont: Menlo 
---

## Setup



```{r,message=FALSE}
library(plyr)
library(dplyr)
library(data.table)
library(lubridate)
library(caret)
library(zoo)
library(doMC)
registerDoMC(cores = 8)
```

Data Loading and cleaning

```{r}
remove(activityTest,activityTrain)
downloadData <- function(tableName,sourceURL) {
    envirPos <- 1
    baseFolder <- "data"
    downloadFilePath <- file.path(baseFolder,paste(tableName,"csv",sep="."))
    downloadTablePath <- file.path(baseFolder,paste(tableName,"rds",sep="."))
    if(!exists(tableName)) {
        if(!file.exists(downloadTablePath)) {
            if(!file.exists(downloadFilePath)) {
                download.file(sourceURL,destfile=downloadFilePath)
            }
            readTable <- fread(downloadFilePath)
            saveRDS(readTable,file=downloadTablePath)
        } else {
            readTable <- readRDS(downloadTablePath)
        }
        assign(tableName,readTable,pos=envirPos)
    }
}
downloadData("activityValidation","http://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv")
downloadData("activityTrain","http://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv")

inputTrain <- activityTrain %>% 
    mutate(V1=as.integer(V1), user_name=factor(user_name), cvtd_timestamp=dmy_hms(cvtd_timestamp), new_window=factor(new_window), classe=factor(classe)) %>% 
    data.frame
inputValidation <- activityValidation %>% mutate(V1=as.integer(V1),user_name=factor(user_name), cvtd_timestamp=dmy_hms(cvtd_timestamp),new_window=factor(new_window), min_yaw_forearm=as.numeric(min_yaw_forearm), skewness_pitch_forearm=as.numeric(skewness_pitch_forearm), skewness_yaw_forearm=as.numeric(skewness_yaw_forearm), problem_id=factor(problem_id)) %>% data.frame

numericColumnRegex <- ".*(arm|dumbbell|belt).*"
numericTrainColumnIndexes <- grep(numericColumnRegex,names(inputTrain))
inputTrain[,numericTrainColumnIndexes] <- sapply(inputTrain[,numericTrainColumnIndexes],as.numeric)
numericValidationColumnIndexes <- grep(numericColumnRegex,names(inputValidation))
inputValidation[,numericValidationColumnIndexes] <- sapply(inputValidation[,numericValidationColumnIndexes],as.numeric)

inputTrain<-na.locf(inputTrain)
inputValidation<-na.locf(inputValidation)
```

You can also embed plots, for example:

```{r}
set.seed(42)
indexTraining <- createDataPartition(inputTrain$V1,p=0.6,list=FALSE)
trainingSet <- inputTrain[indexTraining,] %>% select(-V1)
testingSet<- inputTrain[-indexTraining,] %>% select(-V1)

modfit <- train(classe ~ . ,preProcess="pca",method="rf",data=trainingSet)

```

```{r, echo=FALSE}
plot(cars)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
